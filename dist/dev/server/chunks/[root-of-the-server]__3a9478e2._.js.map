{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/shamir/Desktop/Zaam/ms-zaam-technologies-smart-match-mate-web/proxy.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nexport function proxy(request: NextRequest) {\n  const url = request.nextUrl.clone();\n  const hostname = (request.headers.get('host') || '').replace(/:\\d+$/, ''); // Remove port\n  const pathname = url.pathname;\n\n  console.log('Middleware - hostname:', hostname, 'pathname:', pathname);\n\n  // === Normalize hostname (remove port) ===\n  const cleanHost = hostname.replace(/:\\d+$/, ''); // e.g. app.one-night-stand.local:3000 → app.one-night-stand.local\n\n  console.log('Normalized hostname:', cleanHost);\n\n  // === APP SUBDOMAIN ===\n  const isAppSubdomain =\n    cleanHost === 'app.one-night-stand.local' ||\n    cleanHost === 'app.localhost' ||\n    cleanHost === 'app.one-night-stand.co';\n\n\n    console.log('Is app subdomain:', isAppSubdomain);\n\n  if (isAppSubdomain) {\n    console.log('App subdomain detected:', cleanHost);\n\n    // Redirect root or /(public) to /app\n    if (pathname === '/' || pathname.startsWith('/(public)')) {\n      url.pathname = '/app';\n      return NextResponse.redirect(url);\n    }\n\n    // Handle /app or /app/\n    if (pathname === '/app' || pathname === '/app/') {\n      url.pathname = '/(authenticated)/app';\n      console.log('Rewrite /app → /(authenticated)/app');\n      return NextResponse.rewrite(url);\n    }\n\n    // Dynamic routes\n    const dynamicRoutes = [\n      { pattern: /^\\/chat\\/([^\\/]+)$/, rewrite: '/(authenticated)/chat/$1' },\n      { pattern: /^\\/profile\\/([^\\/]+)$/, rewrite: '/(authenticated)/profile/$1' },\n      { pattern: /^\\/profile\\/([^\\/]+)\\/edit$/, rewrite: '/(authenticated)/profile/$1/edit' },\n      { pattern: /^\\/user\\/([^\\/]+)$/, rewrite: '/(authenticated)/user/$1' },\n    ];\n\n    for (const { pattern, rewrite } of dynamicRoutes) {\n      const match = pathname.match(pattern);\n      if (match) {\n        url.pathname = rewrite.replace('$1', match[1]);\n        console.log(`Dynamic rewrite: ${pathname} → ${url.pathname}`);\n        return NextResponse.rewrite(url);\n      }\n    }\n\n    // Authenticated paths (non-dynamic)\n    const authPaths = ['/matches', '/chat', '/profile', '/settings', '/user'];\n    if (authPaths.some(p => pathname.startsWith(p)) && !pathname.startsWith('/(authenticated)')) {\n      url.pathname = `/(authenticated)${pathname}`;\n      console.log(`Auth rewrite: ${pathname} → ${url.pathname}`);\n      return NextResponse.rewrite(url);\n    }\n\n    return NextResponse.next();\n  }\n\n  // === MAIN DOMAIN (one-night-stand.local, localhost, one-night-stand.co) ===\n  const isMainDomain =\n    cleanHost === 'one-night-stand.local' ||\n    cleanHost === 'localhost' ||\n    cleanHost === 'one-night-stand.co';\n\n    console.log('Is main domain:', isMainDomain);\n\n  if (isMainDomain) {\n    console.log('Main domain:', cleanHost);\n\n    const appPaths = ['/matches', '/chat', '/profile', '/settings', '/app', '/user'];\n    if (appPaths.some(p => pathname.startsWith(p))) {\n      const isAuthenticated = false; // Replace with real auth\n\n      if (isAuthenticated) {\n        const appUrl = new URL(request.url);\n        appUrl.hostname = cleanHost.includes('localhost')\n          ? 'app.localhost'\n          : 'app.one-night-stand.local';\n        return NextResponse.redirect(appUrl);\n      } else {\n        const loginUrl = new URL('/', request.url);\n        loginUrl.searchParams.set('redirect', request.url);\n        return NextResponse.redirect(loginUrl);\n      }\n    }\n\n    // Public routes → (public) group\n\n    console.log('Public route check:', pathname);\n    if (pathname === '/' || pathname.startsWith('/features') || pathname.startsWith('/pricing') || pathname.startsWith('/login')) {\n      if (!pathname.startsWith('/(public)')) {\n        url.pathname = `/(public)${pathname}`;\n        console.log(`Public rewrite: ${pathname} → ${url.pathname}`);\n        return NextResponse.rewrite(url);\n      }\n    }\n\n    return NextResponse.next();\n  }\n\n  // Unknown host → optional: redirect to main\n  console.log('Unknown host:', cleanHost);\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};\n\n\n// import { NextResponse } from 'next/server';\n// import type { NextRequest } from 'next/server';\n\n// export function middleware(request: NextRequest) {\n//   const url = request.nextUrl.clone();\n//   const hostname = request.headers.get('host') || '';\n  \n//   // Get the subdomain\n//   const subdomain = hostname.split('.')[0];\n  \n//   console.log('Middleware - hostname:', hostname, 'subdomain:', subdomain, 'pathname:', url.pathname);\n  \n//   // Handle different subdomains\n//   if (subdomain === 'app' || hostname.includes('app.one-night-stand.co') || hostname.includes('app.localhost') || hostname.includes('app.one-night-stand.local')) {\n//     // App subdomain - handle authenticated routes with dynamic IDs\n    \n//     // Check if user is trying to access public routes on app subdomain\n//     if (url.pathname === '/' || url.pathname.startsWith('/(public)')) {\n//       // Redirect to app dashboard\n//       url.pathname = '/app';\n//       return NextResponse.redirect(url);\n//     }\n    \n//     // Handle root app route specially - exact path matching\n//     if (url.pathname === '/app' || url.pathname === '/app/') {\n//       // Normalize pathname and rewrite to route group\n//       const rewriteUrl = new URL(request.url);\n//       rewriteUrl.pathname = '/(authenticated)/app';\n//       console.log('Root app route rewrite:', request.nextUrl.pathname, '→', rewriteUrl.pathname);\n//       return NextResponse.rewrite(rewriteUrl);\n//     }\n    \n//     // Handle dynamic routes with IDs (chat/[conversationId], profile/[userId], etc.)\n//     const dynamicRoutes = [\n//       { pattern: /^\\/chat\\/([^\\/]+)$/, rewrite: '/(authenticated)/chat/$1' },\n//       { pattern: /^\\/profile\\/([^\\/]+)$/, rewrite: '/(authenticated)/profile/$1' },\n//       { pattern: /^\\/profile\\/([^\\/]+)\\/edit$/, rewrite: '/(authenticated)/profile/$1/edit' },\n//       { pattern: /^\\/user\\/([^\\/]+)$/, rewrite: '/(authenticated)/user/$1' }\n//     ];\n    \n//     // Check for dynamic route matches\n//     for (const route of dynamicRoutes) {\n//       const match = url.pathname.match(route.pattern);\n//       if (match) {\n//         url.pathname = route.rewrite.replace('$1', match[1]);\n//         console.log('Dynamic route rewrite:', request.nextUrl.pathname, '→', url.pathname);\n//         return NextResponse.rewrite(url);\n//       }\n//     }\n    \n//     // Check if accessing authenticated routes without (authenticated) prefix (excluding /app which we handle above)\n//     const authenticatedPaths = ['/matches', '/chat', '/profile', '/settings', '/user'];\n//     if (authenticatedPaths.some(path => url.pathname.startsWith(path))) {\n//       // Rewrite to authenticated route group\n//       if (!url.pathname.startsWith('/(authenticated)')) {\n//         url.pathname = `/(authenticated)${url.pathname}`;\n//         console.log('Auth route rewrite:', request.nextUrl.pathname, '→', url.pathname);\n//         return NextResponse.rewrite(url);\n//       }\n//     }\n    \n//     // TODO: Add JWT/session authentication check here for production\n//     // const token = request.cookies.get('auth-token')?.value;\n//     // const isAuthenticated = await validateAuthToken(token);\n//     // if (!isAuthenticated && !url.pathname.startsWith('/login')) {\n//     //   const loginUrl = new URL('/', request.url);\n//     //   loginUrl.hostname = hostname.replace('app.', '');\n//     //   loginUrl.searchParams.set('redirect', request.url);\n//     //   return NextResponse.redirect(loginUrl);\n//     // }\n    \n//     return NextResponse.next();\n//   } \n  \n//   // Main domain - handle public routes and redirects\n//   if (hostname.includes('one-night-stand.co') || (hostname.includes('localhost') || hostname.includes('.local')) && !hostname.includes('app.')) {\n    \n//     // Check if user is trying to access app routes on main domain\n//     const appPaths = ['/matches', '/chat', '/profile', '/settings', '/app', '/user'];\n//     if (appPaths.some(path => url.pathname.startsWith(path))) {\n//       // TODO: Check authentication status\n//       // const token = request.cookies.get('auth-token')?.value;\n//       // const isAuthenticated = await validateAuthToken(token);\n//       const isAuthenticated = false; // Replace with real auth check\n      \n//       if (isAuthenticated) {\n//         // Redirect to app subdomain with same path\n//         const appUrl = new URL(url);\n//         if (hostname.includes('localhost')) {\n//           appUrl.hostname = `app.localhost`;\n//         } else if (hostname.includes('.local')) {\n//           appUrl.hostname = `app.one-night-stand.local`;\n//         } else {\n//           appUrl.hostname = `app.${hostname}`;\n//         }\n//         console.log('Redirecting to app subdomain:', appUrl.href);\n//         return NextResponse.redirect(appUrl);\n//       } else {\n//         // Redirect to login page with redirect parameter\n//         const loginUrl = new URL('/', request.url);\n//         loginUrl.searchParams.set('redirect', request.url);\n//         return NextResponse.redirect(loginUrl);\n//       }\n//     }\n    \n//     // Rewrite public routes to (public) group\n//     console.log('Public route check:', url.pathname);\n//     if (url.pathname === '/' || url.pathname.startsWith('/features') || url.pathname.startsWith('/pricing') || url.pathname.startsWith('/login')) {\n//       if (!url.pathname.startsWith('/(public)')) {\n//         url.pathname = `/(public)${url.pathname}`;\n//         console.log('Public route rewrite:', request.nextUrl.pathname, '→', url.pathname);\n//         return NextResponse.rewrite(url);\n//       }\n//     }\n    \n//     return NextResponse.next();\n//   }\n  \n//   return NextResponse.next();\n// }\n\n// export const config = {\n//   matcher: [\n//     /*\n//      * Match all request paths except for the ones starting with:\n//      * - api (API routes)\n//      * - _next/static (static files)\n//      * - _next/image (image optimization files)\n//      * - favicon.ico (favicon file)\n//      * - public files (images, etc.)\n//      */\n//     '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n//   ],\n// };"],"names":[],"mappings":"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","debugId":null}}]
}